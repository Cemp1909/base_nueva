services:
  - type: web
    name: base_nueva
    plan: free
    env: python
    buildCommand: pip install -r requirements.txt
    startCommand: gunicorn app:app --bind 0.0.0.0:10000
    envVars:
      - key: DATABASE_URL
        fromDatabase: 
         name : db_tienda
      - key: INFLUX_URL
        # ðŸ‘‰ despuÃ©s del primer deploy, reemplaza esto con la URL pÃºblica de tu servicio "influxdb"
        value: "https://<URL-publica-de-influxdb>"
      - key: INFLUX_ORG
        value: "MiLab"
      - key: INFLUX_BUCKET
        value: "Sensores"
      - key: INFLUX_TOKEN
        sync: false
      # ðŸ‘‰ Broker MQTT externo (p.ej. HiveMQ pÃºblico). Cambia si usas otro.
      - key: MQTT_BROKER
        value: "broker.hivemq.com"
      - key: MQTT_PORT
        value: "1883"

  # InfluxDB como servicio web con runtime Docker
  - type: web
    name: influxdb
    plan: free
    env: docker
    dockerfilePath: ./render/influxdb.Dockerfile
    disk:
      name: influx-data
      mountPath: /var/lib/influxdb2
      sizeGB: 5
    envVars:
      - key: DOCKER_INFLUXDB_INIT_MODE
        value: setup
      - key: DOCKER_INFLUXDB_INIT_USERNAME
        value: admin
      - key: DOCKER_INFLUXDB_INIT_PASSWORD
        sync: false
      - key: DOCKER_INFLUXDB_INIT_ORG
        value: MiLab
      - key: DOCKER_INFLUXDB_INIT_BUCKET
        value: Sensores
      - key: DOCKER_INFLUXDB_INIT_ADMIN_TOKEN
        sync: false

  # Grafana como servicio web con runtime Docker
  - type: web
    name: grafana
    plan: free
    env: docker
    dockerfilePath: ./render/grafana.Dockerfile
    envVars:
      - key: GF_SECURITY_ADMIN_USER
        value: admin
      - key: GF_SECURITY_ADMIN_PASSWORD
        sync: false

databases:
  - name: db_tienda
    databaseName: tienda
